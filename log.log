
╔═══════════════════════════════════════════════════════════════╗
║     NGINX REVERSE PROXY + SSL AUTOMATICO                      ║
╚═══════════════════════════════════════════════════════════════╝


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  STEP 1/8 - Rete Docker
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Reti Docker esistenti:
• n8n-net

Rete attuale (da .env): n8n-net
Usare questa rete? [Y/n]: Y
[✓] Rete 'n8n-net' OK

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  STEP 2/8 - Email Let's Encrypt
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Email attuale: tasuhiro.davide@gmail.com
Usare questa email? [Y/n]: Y
[✓] Email: tasuhiro.davide@gmail.com

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  STEP 3/8 - Modalità SSL
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  1) PRODUZIONE - certificati validi (limite: 5/settimana per dominio)
  2) STAGING    - certificati test (illimitati, per debug)

Scegli [1/2, default: 1]: 2
[!] STAGING attivo - certificati NON validi per browser

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  STEP 4/8 - Avvio Nginx Proxy
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[✓] .env generato
Avvio container...
[+] up 24/24
 ✔ Image nginxproxy/nginx-proxy:latest Pulled                                                                      7.6s
 ✔ Image nginxproxy/acme-companion:latest Pulled                                                                   6.3s
 ✔ Network nginx-proxy_proxy-network Created                                                                       0.1s
 ✔ Container nginx-proxy   Created                                                                                 0.2s
 ✔ Container nginx-proxy-acme Created                                                                              0.0s
[✓] nginx-proxy attivo
[✓] acme-companion attivo

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  STEP 5/8 - Seleziona Container da Esporre
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Container disponibili:

   1) n8n                       [n8n] ports: 5678
   2) n8n-postgres              [postgres] ports: 5432
   3) portainer                 [portainer-ce] ports: 8000 9000 9443

Seleziona [1-3]: 1
[✓] Container: n8n

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  STEP 6/8 - Sottodominio
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Inserisci il sottodominio COMPLETO che vuoi usare per n8n

Esempi:
  • n8n.tuodominio.com
  • chat.example.org
  • glpi.azienda.it

Sottodominio: n8n.tasuthor.com
[✓] Sottodominio: n8n.tasuthor.com
[✓] DNS: 207.154.252.110

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  STEP 7/8 - Porta Interna
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Porta rilevata: 5678
Usare questa porta? [Y/n]: Y
[✓] Porta: 5678

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  STEP 8/8 - Riepilogo
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━


  Container:     n8n
  Sottodominio:  n8n.tasuthor.com
  Porta:         5678
  Email:         tasuhiro.davide@gmail.com
  Rete:          n8n-net
  Modalità:      STAGING (test)

Procedo con la configurazione? [Y/n]: Y

Applicazione configurazione...
[✓] Config salvata: configs/n8n.conf

╔═══════════════════════════════════════════════════════════════╗
║                    CONFIGURAZIONE COMPLETATA                  ║
╚═══════════════════════════════════════════════════════════════╝

[!] AZIONE RICHIESTA: Devi ricreare il container con le variabili proxy

Se usi docker run, ricrea il container con:

docker stop n8n && docker rm n8n
docker run -d --name n8n \033[0m
  --network n8n-net \033[0m
  -e VIRTUAL_HOST=n8n.tasuthor.com \033[0m
  -e VIRTUAL_PORT=5678 \033[0m
  -e LETSENCRYPT_HOST=n8n.tasuthor.com \033[0m
  -e LETSENCRYPT_EMAIL=tasuhiro.davide@gmail.com \033[0m
  [altre opzioni originali] <immagine>

─────────────────────────────────────────────────────────────────

Se usi docker-compose, aggiungi al tuo docker-compose.yml:

services:
  n8n:
    environment:
      - VIRTUAL_HOST=n8n.tasuthor.com
      - VIRTUAL_PORT=5678
      - LETSENCRYPT_HOST=n8n.tasuthor.com
      - LETSENCRYPT_EMAIL=tasuhiro.davide@gmail.com
    networks:
      - n8n-net

networks:
  n8n-net:
    external: true

Poi: docker compose up -d

─────────────────────────────────────────────────────────────────

[!] ATTENZIONE: Modalità STAGING - il certificato NON sarà valido

Verifica:
  docker logs nginx-proxy-acme -f     # Log certificati
  curl -I https://n8n.tasuthor.com        # Test (dopo DNS ok)

Configurare un altro servizio? [y/N]: N
[✓] Setup completato!

oot@ubuntu-s-1vcpu-2gb-fra1-01:~/Installation-guide-docker/applications/nginx-proxy# curl -I https://n8n.tasuthor.com
curl: (7) Failed to connect to n8n.tasuthor.com port 443 after 3 ms: Couldn't connect to server
root@ubuntu-s-1vcpu-2gb-fra1-01:~/Installation-guide-docker/applications/nginx-proxy# docker logs nginx-proxy-acme -f
Info: running acme-companion version v2.6.2-10-g389e6e1
Info: 4096 bits RFC7919 Diffie-Hellman group found, generation skipped.
Reloading nginx proxy (d92a194c2fffef2c1e1cfc28aa2a8efd4e40ded740751aca16f1c4bc7080c0f2)...
2025/12/31 02:27:18 Generated '/etc/nginx/conf.d/default.conf' from 5 containers
2025/12/31 02:27:18 [emerg] 130#130: unexpected end of file, expecting ";" or "}" in /etc/nginx/conf.d/custom.conf:35
2025/12/31 02:27:18 Generated '/app/letsencrypt_service_data' from 5 containers
2025/12/31 02:27:18 Running '/app/signal_le_service'
2025/12/31 02:27:18 Watching docker events
2025/12/31 02:27:18 Contents of /app/letsencrypt_service_data did not change. Skipping notification '/app/signal_le_service'
Creating/renewal n8n.tuodominio.com certificates... (n8n.tuodominio.com)
[Wed Dec 31 02:27:20 UTC 2025] Using CA: https://acme-staging-v02.api.letsencrypt.org/directory
[Wed Dec 31 02:27:21 UTC 2025] Using pre-generated key: /etc/acme.sh/staging/n8n.tuodominio.com/n8n.tuodominio.com.key.next
[Wed Dec 31 02:27:21 UTC 2025] Generating next pre-generate key.
[Wed Dec 31 02:27:21 UTC 2025] Single domain='n8n.tuodominio.com'
[Wed Dec 31 02:27:25 UTC 2025] Getting webroot for domain='n8n.tuodominio.com'
[Wed Dec 31 02:27:26 UTC 2025] Verifying: n8n.tuodominio.com
[Wed Dec 31 02:27:27 UTC 2025] Pending. The CA is processing your order, please wait. (1/30)
[Wed Dec 31 02:27:31 UTC 2025] n8n.tuodominio.com: Invalid status. Verification error details: 2606:4700:20::681a:725: Invalid response from https://www.hugedomains.com/domain_profile.cfm?d=tuodominio.com:
[Wed Dec 31 02:27:31 UTC 2025] Please check log file for more details: /dev/null
Sleep for 3600s
